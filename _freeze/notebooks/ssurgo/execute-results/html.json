{
    "hash": "cfaae68d49c145a6be748c0ec7284cb5",
    "result": {
        "engine": "jupyter",
        "markdown": "---\njupyter: python3\nauthor: Corey T. White\nexecute:\n  eval: true\n  freeze: auto\ndate-modified: today\nformat:\n  html:\n    toc: true\n    code-tools: true\n    code-copy: true\n    code-fold: false\n---\n\n# SSURGO Soil Data in GRASS\n\n\n\n::: {#init_session .cell execution_count=2}\n``` {.python .cell-code}\ngisdb = os.path.join(os.getenv(\"HOME\"), \"grassdata\")\nsite = \"coweeta\"\nmapset = \"ssurgo_demo\"\nsession = gj.init(gisdb, site, \"PERMANENT\")\ntools = Tools(session=session)\ntry:\n    tools.g_mapset(mapset=mapset, flags=\"c\")\nexcept Exception as e:\n    print(f\"{e}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRun `g.mapset -c mapset=ssurgo_demo` ended with an error (return code 1):\nERROR: There appears to be an active GRASS session in selected mapset\n       <ssurgo_demo>\n\n```\n:::\n:::\n\n\nInstall the `r.in.ssurgo` extension if it is not already installed. This extension is available in the GRASS Addons repository and can be installed using `g.extension`. The source code for this extension is also available in the `tools/r.soildb/r.in.ssurgo` directory of this repository.\n\n::: {#install_extension .cell execution_count=3}\n``` {.python .cell-code}\ntools.g_extension(\n    extension=\"r.in.ssurgo\",\n    url=\"../tools/r.soildb/r.in.ssurgo\",\n)\n```\n:::\n\n\nSet the computational region to the elevation raster and create a relief raster for hillshading.\n\n::: {#set_region .cell execution_count=4}\n``` {.python .cell-code}\nregion_text = tools.g_region(raster=\"elevation\", flags=\"p\").text\ntools.r_relief(input=\"elevation\", output=\"relief\")\nprint(region_text)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nprojection: 1 (UTM)\nzone:       17\ndatum:      nad83\nellipsoid:  grs80\nnorth:      3884960\nsouth:      3876990\nwest:       272970\neast:       280150\nnsres:      10\newres:      10\nrows:       797\ncols:       718\ncells:      572246\n```\n:::\n:::\n\n\nImport SSURGO data using `r.in.ssurgo`. Note that this will import the soil areas map, hydrologic group map, and ksat maps for low, regular, and high values. The `mukey` column is also imported as a raster with a categorical color scheme applied. The hydrologic group map also has a categorical color scheme applied.\n\n::: {#import_ssurgo .cell execution_count=5}\n``` {.python .cell-code}\ntools.r_in_ssurgo(\n    ssurgo_path=\"../data/gSSURGO_CONUS.zip/gSSURGO_CONUS.gdb\",\n    ssurgo_areas=\"soil_areas\",\n    hydgrp=\"hydgrp\",\n    ksat_l=\"ksat_l\",\n    ksat_r=\"ksat_r\",\n    ksat_h=\"ksat_h\",\n    mukey=\"mukey\",\n    hzdept_r=0,\n    hzdepb_r=100,\n    desgnmaster=\"A\",\n)\n```\n:::\n\n\n::: {#vector_maps .cell execution_count=6}\n``` {.python .cell-code}\nprint(tools.g_list(type=\"vector\", mapset=mapset).text)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nsoil_areas\n```\n:::\n:::\n\n\n::: {#cell-soil attributes .cell execution_count=7}\n``` {.python .cell-code}\njson_data = tools.v_db_select(map=\"soil_areas\", format=\"json\").json\ndf = pd.DataFrame(json_data[\"records\"])\ndf.head()\n```\n\n::: {#soil-attributes .cell-output .cell-output-display execution_count=5}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>cat</th>\n      <th>mukey</th>\n      <th>mukey_int</th>\n      <th>cokey</th>\n      <th>compname</th>\n      <th>comppct_r</th>\n      <th>runoff</th>\n      <th>hydgrp</th>\n      <th>hydricon</th>\n      <th>hydricrating</th>\n      <th>drainagecl</th>\n      <th>ksat_l</th>\n      <th>ksat_r</th>\n      <th>ksat_h</th>\n      <th>hsg</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>545807</td>\n      <td>545807</td>\n      <td>26047851</td>\n      <td>Chandler</td>\n      <td>80</td>\n      <td>Medium</td>\n      <td>A</td>\n      <td>None</td>\n      <td>No</td>\n      <td>Somewhat excessively drained</td>\n      <td>50.399996</td>\n      <td>100.799992</td>\n      <td>151.199998</td>\n      <td>1.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2</td>\n      <td>545805</td>\n      <td>545805</td>\n      <td>26047849</td>\n      <td>Chandler</td>\n      <td>80</td>\n      <td>Medium</td>\n      <td>A</td>\n      <td>None</td>\n      <td>No</td>\n      <td>Somewhat excessively drained</td>\n      <td>50.399996</td>\n      <td>100.799992</td>\n      <td>151.199998</td>\n      <td>1.0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>3</td>\n      <td>545803</td>\n      <td>545803</td>\n      <td>26047860</td>\n      <td>Cashiers</td>\n      <td>80</td>\n      <td>Medium</td>\n      <td>A</td>\n      <td>None</td>\n      <td>No</td>\n      <td>Well drained</td>\n      <td>50.399997</td>\n      <td>100.799994</td>\n      <td>151.200000</td>\n      <td>1.0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>4</td>\n      <td>545800</td>\n      <td>545800</td>\n      <td>26047848</td>\n      <td>Burton</td>\n      <td>45</td>\n      <td>Very high</td>\n      <td>B</td>\n      <td>None</td>\n      <td>No</td>\n      <td>Well drained</td>\n      <td>50.399998</td>\n      <td>100.799997</td>\n      <td>151.199998</td>\n      <td>2.0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>5</td>\n      <td>545800</td>\n      <td>545800</td>\n      <td>26047846</td>\n      <td>Rock outcrop</td>\n      <td>15</td>\n      <td>Very high</td>\n      <td>None</td>\n      <td>None</td>\n      <td>No</td>\n      <td>None</td>\n      <td>50.399998</td>\n      <td>100.799997</td>\n      <td>151.199998</td>\n      <td>NaN</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {#list_rasters .cell execution_count=8}\n``` {.python .cell-code}\nprint(tools.g_list(type=\"raster\", mapset=mapset).text)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nhydgrp\nksat_h\nksat_l\nksat_r\nmukey\nrelief\n```\n:::\n:::\n\n\n## MUKEY Map\n\n::: {#cell-mukey .cell execution_count=9}\n``` {.python .cell-code}\nm = gj.Map(use_region=True)\nm.d_shade(shade=\"relief\", color=\"mukey\")\n# m.d_legend(raster=\"mukey\", title=\"MUKEY\", flags=\"b\")\nm.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](ssurgo_files/figure-html/mukey-output-1.png){#mukey}\n:::\n:::\n\n\n## Ksat Maps\n\n### Regular\n\n::: {#ksat .cell layout-ncol='3' execution_count=10}\n``` {.python .cell-code}\nm = gj.Map(use_region=True)\nm.d_shade(shade=\"relief\", color=\"ksat_l\")\nm.d_legend(raster=\"ksat_l\", title=\"Ksat (mm/hr)\", flags=\"b\")\nm.show()\n\nm = gj.Map(use_region=True)\nm.d_shade(shade=\"relief\", color=\"ksat_r\")\nm.d_legend(raster=\"ksat_r\", title=\"Ksat (mm/hr)\", flags=\"b\")\nm.show()\n\nm = gj.Map(use_region=True)\nm.d_shade(shade=\"relief\", color=\"ksat_h\")\nm.d_legend(raster=\"ksat_h\", title=\"Ksat (mm/hr)\", flags=\"b\")\nm.show()\n```\n\n::: {.cell-output .cell-output-display}\n![Low](ssurgo_files/figure-html/ksat-output-1.png){#ksat-1}\n:::\n\n::: {.cell-output .cell-output-display}\n![Regular](ssurgo_files/figure-html/ksat-output-2.png){#ksat-2}\n:::\n\n::: {.cell-output .cell-output-display}\n![High](ssurgo_files/figure-html/ksat-output-3.png){#ksat-3}\n:::\n\nKsat maps for low, regular, and high values\n:::\n\n\n## Hydrologic Group\n\n::: {#cell-hydrologic_group_map .cell execution_count=11}\n``` {.python .cell-code}\nm = gj.Map(use_region=True)\nm.d_rast(map=\"hsg\")\nm.d_shade(shade=\"relief\", color=\"hsg\")\nm.d_legend(raster=\"hsg\", title=\"Group\", flags=\"b\")\nm.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](ssurgo_files/figure-html/hydrologic_group_map-output-1.png){#hydrologic_group_map}\n:::\n:::\n\n\n## Curve Number\n\nInstall the `r.curvenumber` extension if it is not already installed. This extension is available in the GRASS Addons repository and can be installed using `g.extension`.\n\n::: {#install_curvenumber .cell execution_count=12}\n``` {.python .cell-code}\ntools.g_extension(\n    extension=\"r.curvenumber\",\n)\n```\n:::\n\n\nTo calculate the curve number, we need both a land cover map and a hydrologic soil group map. The land cover map is from the National Land Cover Database (NLCD) 2024 dataset, which was imported as a COG raster. The `landcover_source` parameter specifies that the land cover map is from the NLCD dataset, which allows the tool to use the appropriate lookup table for curve number values.\n\n::: {#import_landcover .cell execution_count=13}\n``` {.python .cell-code}\ntools.r_import(\n    output=\"nlcd_2024\",\n    input=\"<path_to_nlcd_cog>\",\n    extent=\"region\",\n    resolution=\"region\",\n)\n```\n:::\n\n\n::: {#cell-landcover_map .cell execution_count=14}\n``` {.python .cell-code}\nm = gj.Map(use_region=True)\nm.d_shade(shade=\"relief\", color=\"nlcd_2024\")\nm.d_legend(raster=\"nlcd_2024\", title=\"NLCD 2024\", flags=\"b\")\nm.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](ssurgo_files/figure-html/landcover_map-output-1.png){#landcover_map}\n:::\n:::\n\n\nCalculate the hydrolic curve number using the `r.curvenumber` extension, which requires both a land cover map and a hydrologic soil group map. The land cover map is from the National Land Cover Database (NLCD) 2024 dataset, which was imported as a COG raster. The `landcover_source` parameter specifies that the land cover map is from the NLCD dataset, which allows the tool to use the appropriate lookup table for curve number values.\n\n::: {#curvenumber_calc .cell execution_count=15}\n``` {.python .cell-code}\ntools.r_curvenumber(\n    landcover=\"nlcd_2024\", soil=\"hsg\", landcover_source=\"nlcd\", output=\"curvenumber\"\n)\n```\n:::\n\n\n::: {#cell-curvenumber_map .cell execution_count=16}\n``` {.python .cell-code}\nm = gj.Map(use_region=True)\nm.d_shade(shade=\"relief\", color=\"curvenumber\")\nm.d_legend(raster=\"curvenumber\", title=\"Curve Number\", flags=\"b\")\nm.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](ssurgo_files/figure-html/curvenumber_map-output-1.png){#curvenumber_map}\n:::\n:::\n\n\n## Run model\n\n::: {#r_sim_water .cell execution_count=17}\n``` {.python .cell-code}\ntools.r_slope_aspect(elevation=\"elevation\", dx=\"dx\", dy=\"dy\")\ntools.r_sim_water(elevation=\"elevation\", depth=\"depth\", discharge=\"discharge\")\n```\n:::\n\n\n::: {#cell-depth_map .cell execution_count=18}\n``` {.python .cell-code}\nm = gj.Map(use_region=True)\nm.d_rast(map=\"depth\")\nm.d_shade(shade=\"relief\", color=\"depth\")\nm.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](ssurgo_files/figure-html/depth_map-output-1.png){#depth_map}\n:::\n:::\n\n\n::: {#cell-discharge_map .cell execution_count=19}\n``` {.python .cell-code}\nm = gj.Map(use_region=True)\nm.d_rast(map=\"discharge\")\nm.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](ssurgo_files/figure-html/discharge_map-output-1.png){#discharge_map}\n:::\n:::\n\n\n",
        "supporting": [
            "ssurgo_files"
        ],
        "filters": [],
        "includes": {
            "include-in-header": [
                "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
            ]
        }
    }
}
